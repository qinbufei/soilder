<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>canvas画布8</title>
	<style type="text/css">
	</style>
</head>
<body>
	
	<script type="text/javascript">


			var canvas = document.createElement( 'canvas' );
		    canvas.width = 900;
		    canvas.height = 600;
		    canvas.style.border = '1px solid red';
		    document.body.appendChild( canvas );
		    // 获得 CanvasRenderingContext2D 对象		    
		    // 设置 起点
		    var ctx = canvas.getContext( '2d' );

    		var url = 'imgs/士兵(1).png';
		    // 创建 img 对象
		    var img = new Image(); // 就是 img 标签
		    // 设置 src 属性为 图片
		    img.src = url;

		    // 绘图
		    img.onload = function () {
		    	
		    	console.log(img.width/4);
		    	console.log(img.height/4);
		    	var width=img.width/4;
		    	var height=img.height/4;
		    	var sx=0;
		    	var sy=0;
		    	var dx=10;
		    	var dy=10;

		    	var xSpeed=0;
		    	var ySpeed=0;
		    	var shotSpeed=1;


		    	ctx.drawImage(img,sx*width,sy*height,width,height,dx,dy,width,height);

		        function move() {
			        ctx.clearRect( 0,0,canvas.width,canvas.height);
			        sx++;
			        ctx.drawImage(img,sx*width,sy*height,width,height,dx+=xSpeed,dy+=ySpeed,width,height);

		            if(sx>=3){
		            	sx=-1;
		            };
		            
		            if(dx>canvas.width){
		            	dx=(0-width);
		            };
		            if(dx<(0-width)){
		            	dx=canvas.width;
		            };
		            if(dy>canvas.height){
		            	dy=(0-height);
		            };
		            if(dy<(0-height)){
		            	dy=canvas.height;
		            };
		        };

		        function shot(){
		        	if(sy==1){
		        		var shotx=dx-10;
			        	var shoty=dy+30;
					   	ctx.fillStyle = 'red';
					    ctx.arc( shotx, shoty, 5, -Math.PI/2, Math.PI*3/2 );
					    ctx.fill();
			    		var x=0;
			    		setInterval(function() {
				            ctx.clearRect( shotx-6, shoty-6, 12, 12);
				            ctx.beginPath();
				            ctx.arc( shotx-=shotSpeed, shoty, 5, -Math.PI/2, Math.PI*3/2 );
				            ctx.fill();
			        	}, 1);
		        	}
		        	if(sy==2){
		        		var shotx=dx+60;
			        	var shoty=dy+30;
					   	ctx.fillStyle = 'red';
					    ctx.arc( shotx, shoty, 5, -Math.PI/2, Math.PI*3/2 );
					    ctx.fill();
			    		var x=0;
			    		setInterval(function() {
				            ctx.clearRect( shotx-6, shoty-6, 12, 12);
				            ctx.beginPath();
				            ctx.arc( shotx+=shotSpeed, shoty, 5, -Math.PI/2, Math.PI*3/2 );
				            ctx.fill();
			        	}, 1);
		        	}
		        	if(sy==3){
		        		var shotx=dx+25;
			        	var shoty=dy-10;
					   	ctx.fillStyle = 'red';
					    ctx.arc( shotx, shoty, 5, -Math.PI/2, Math.PI*3/2 );
					    ctx.fill();
			    		var x=0;
			    		setInterval(function() {
				            ctx.clearRect( shotx-6, shoty-6, 12, 12);
				            ctx.beginPath();
				            ctx.arc( shotx, shoty-=shotSpeed, 5, -Math.PI/2, Math.PI*3/2 );
				            ctx.fill();
			        	}, 1);
		        	}
		        	if(sy==0){
		        		var shotx=dx+25;
			        	var shoty=dy+75;
					   	ctx.fillStyle = 'red';
					    ctx.arc( shotx, shoty, 5, -Math.PI/2, Math.PI*3/2 );
					    ctx.fill();
			    		var x=0;
			    		setInterval(function() {
				            ctx.clearRect( shotx-6, shoty-6, 12, 12);
				            ctx.beginPath();
				            ctx.arc( shotx, shoty+=shotSpeed, 5, -Math.PI/2, Math.PI*3/2 );
				            ctx.fill();
			        	}, 1);
		        	}
		        	
		        }

		        document.onkeydown=function(ev){		    	
			    	console.log(ev.keyCode);
			    	if(ev.keyCode==37||ev.keyCode==65){		    		
			    		sy=1;
			    		xSpeed=-7;
			    		ySpeed=0;
			    		move();
			    	}
			    	if(ev.keyCode==39||ev.keyCode==68){		    		
			    		sy=2;
			    		xSpeed=7;
			    		ySpeed=0;
			    		move();
			    	}
			    	if(ev.keyCode==38||ev.keyCode==87){			    		
			    		sy=3;
			    		xSpeed=0;
			    		ySpeed=-3;
			    		move();
			    	}
			    	if(ev.keyCode==40||ev.keyCode==83){			    		
			    		sy=0;
			    		xSpeed=0;
			    		ySpeed=3;
			    		move();
			    	}
			    	if(ev.keyCode==32){			    		
			    		shot();
			    	}
		    	}
		    };

	</script>
</body>
</html>